
# Eternal Blue  
MS17-010/CVE-2017-0144 est une collection de vulnérabilités windows et d'exploits qui permettent d'exécuter du code arbitraire à distance et d'avoir un contrôle d'accès avec privilèges.  
L'exploit EternalBlue a été utilisé dans l'attaque par le ransomewar WannaCry.  

**Machines vulnérables :**  
Win Vista
Win 7
Win Server 2008
Win 8.1
Win Server 2012
Win 10
Win Server 2016

On peut notamment exploiter le protocole SMBv1:  
Ex : `nmap -sV -p 445 -O 10.10.10.12` permet de scanner l'IP indiquée sur le port 445 avec la version du service et l'OS.  
Pour savoir si la cible est vulnérable à la MS17-010, on peut rajouter le script associé `--script=smb-vuln-ms17-01`

## Exploit avec Metasploit
`search eternalblue`. Puis pour lancer un exploit `exploit/windows/smb/ms17_010_eternalblue`, rentrer les options et si l'exploit fonctionne on obtient un meterpreter. `sysinfo` permet de valider que nous sommes bien sur le shell distant. et `getuid` permet de récupérer l'utilisateur (en théorie "system" ici).  

# RDP  
BlueKeep (CVE-2019-0708)  

**Machines vulnérables :**  
* XP  
* Vista  
* Windows 7  
* Windows Server 2008 & R2  

`sudo nmap - 3389 10.10.10.7` pour voir si RDP tourne sur la machine.  
Si le service tourne on lance metasploit `msfconsole`.  
`search BlueKeep` pour chercher les modules d'exploit.  

le scanner permet de voir si la cible est vulnérable. Si oui, il reste lancer l'exploit module, "exploit/windows/rdp/cve_2019_078_bluekeep_rce"  
On paramètre ensuite les infos de la cible,  
Et le "payload options" : c'est à dire l'IP de notre machine et le port d'écoute.  
Il est préférable d'indiquer la target avec `show target`, choisir la version, et lancer l'exploit.  
Si le meterpreter se lance, celà signifie que 'lon est conecté à la machine cible. On peut vérifier avec "sysinfo"  

Cet exploit permet l'exécution de code à distance avec des privilèges élevés.  


